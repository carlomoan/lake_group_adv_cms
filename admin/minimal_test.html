<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Minimal Admin Test</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
</head>
<body>
    <div id="app">
        <h1>Minimal Admin Test</h1>
        <p>Logo Main: <input v-model="content.siteSettings.logoMain" /></p>
        <p>Logo Width: <input v-model.number="content.siteSettings.logoWidth" type="number" /></p>
        <button @click="saveContent">Save</button>
        <button @click="loadContent">Load</button>
        <pre>{{ content.siteSettings }}</pre>
    </div>

    <script>
        // DATABASE_METHODS - exactly as in main file
        window.DATABASE_METHODS = {
            deepMerge(target, source) {
                const output = { ...target };
                if (this.isObject(target) && this.isObject(source)) {
                    Object.keys(source).forEach(key => {
                        if (this.isObject(source[key])) {
                            if (!(key in target)) {
                                Object.assign(output, { [key]: source[key] });
                            } else {
                                output[key] = this.deepMerge(target[key], source[key]);
                            }
                        } else {
                            Object.assign(output, { [key]: source[key] });
                        }
                    });
                }
                return output;
            },

            isObject(item) {
                return item && typeof item === 'object' && !Array.isArray(item);
            },

            async saveContent() {
                try {
                    console.log('Saving:', this.content);
                    const response = await fetch('/admin/save_content.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ content: this.content })
                    });
                    const result = await response.json();
                    console.log('Save result:', result);
                    alert(result.success ? 'Saved!' : 'Error: ' + result.error);
                } catch (error) {
                    console.error('Save error:', error);
                    alert('Save error: ' + error.message);
                }
            },

            async loadContent() {
                try {
                    const response = await fetch('/admin/save_content.php', {
                        method: 'GET',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success && result.content) {
                            console.log('Loaded from database:', result.content);
                            this.content = window.DATABASE_METHODS.deepMerge(this.content, result.content);
                            alert('Loaded from database!');
                            return;
                        }
                    }
                    alert('Load failed');
                } catch (error) {
                    console.error('Load error:', error);
                    alert('Load error: ' + error.message);
                }
            }
        };

        console.log('DATABASE_METHODS loaded:', window.DATABASE_METHODS);
    </script>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    content: {
                        siteSettings: {
                            logoMain: '',
                            logoTransparent: '',
                            logoWidth: 150,
                            logoHeight: 50,
                            logoAltText: 'Logo'
                        }
                    }
                };
            },
            methods: {
                async saveContent() {
                    if (window.DATABASE_METHODS && window.DATABASE_METHODS.saveContent) {
                        return await window.DATABASE_METHODS.saveContent.call(this);
                    } else {
                        alert('DATABASE_METHODS not found!');
                    }
                },
                async loadContent() {
                    if (window.DATABASE_METHODS && window.DATABASE_METHODS.loadContent) {
                        return await window.DATABASE_METHODS.loadContent.call(this);
                    } else {
                        alert('DATABASE_METHODS not found!');
                    }
                }
            },
            mounted() {
                console.log('Vue app mounted');
                if (window.DATABASE_METHODS) {
                    console.log('✅ DATABASE_METHODS available');
                    this.loadContent();
                } else {
                    console.error('❌ DATABASE_METHODS NOT available');
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
