<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Admin Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .tab-nav { margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; margin-right: 10px; border: 1px solid #ccc; background: #f9f9f9; cursor: pointer; }
        .tab-btn.active { background: #007cba; color: white; }
        .tab-content { display: none; padding: 20px; border: 1px solid #ccc; }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 8px; border: 1px solid #ccc; }
        .btn { padding: 10px 20px; background: #007cba; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <div id="app">
        <h1>Admin Dashboard</h1>
        <p><strong>Vue Test:</strong> {{ testMessage }}</p>

        <div class="tab-nav">
            <button :class="['tab-btn', { active: activeTab === 'dashboard' }]" @click="activeTab = 'dashboard'">Dashboard</button>
            <button :class="['tab-btn', { active: activeTab === 'hero' }]" @click="activeTab = 'hero'">Hero</button>
            <button :class="['tab-btn', { active: activeTab === 'services' }]" @click="activeTab = 'services'">Services</button>
        </div>

        <div :class="['tab-content', { active: activeTab === 'dashboard' }]">
            <h2>Dashboard</h2>
            <p>Current tab: {{ getTabTitle(activeTab) }}</p>
            <button class="btn" @click="saveContent">Save All Changes</button>
        </div>

        <div :class="['tab-content', { active: activeTab === 'hero' }]">
            <h2>Hero Section</h2>
            <div class="form-group">
                <label>Hero Title:</label>
                <input v-model="content.hero.title" placeholder="Enter hero title">
            </div>
            <button class="btn" @click="saveContent">Save Hero</button>
        </div>

        <div :class="['tab-content', { active: activeTab === 'services' }]">
            <h2>Services</h2>
            <div class="form-group">
                <label>Services Title:</label>
                <input v-model="content.services.title" placeholder="Enter services title">
            </div>
            <button class="btn" @click="saveContent">Save Services</button>
        </div>

        <div v-if="notification.show" :style="{ background: notification.type === 'success' ? 'green' : 'red', color: 'white', padding: '10px', margin: '10px 0' }">
            {{ notification.message }}
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    activeTab: 'dashboard',
                    testMessage: 'Vue.js is working perfectly!',
                    content: {
                        hero: {
                            title: 'Welcome to Our Website'
                        },
                        services: {
                            title: 'Our Services'
                        }
                    },
                    notification: {
                        show: false,
                        type: 'success',
                        message: ''
                    }
                }
            },
            methods: {
                getTabTitle(tab) {
                    const titles = {
                        dashboard: 'Dashboard Overview',
                        hero: 'Hero Section Management',
                        services: 'Services Management'
                    };
                    return titles[tab] || tab.charAt(0).toUpperCase() + tab.slice(1);
                },

                async saveContent() {
                    try {
                        const response = await fetch('/api/content', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': 'Basic ' + btoa('admin:changeme')
                            },
                            body: JSON.stringify(this.content)
                        });

                        if (response.ok) {
                            this.showNotification('Content saved successfully!', 'success');
                        } else {
                            this.showNotification('Failed to save content', 'error');
                        }
                    } catch (error) {
                        this.showNotification('Error: ' + error.message, 'error');
                    }
                },

                showNotification(message, type) {
                    this.notification = {
                        show: true,
                        type,
                        message
                    };
                    setTimeout(() => {
                        this.notification.show = false;
                    }, 3000);
                }
            },

            async mounted() {
                console.log('Vue app mounted successfully!');
                // Load existing content
                await this.loadContent();
            },

            async loadContent() {
                try {
                    const response = await fetch('/api/content', {
                        headers: {
                            'Authorization': 'Basic ' + btoa('admin:changeme')
                        }
                    });
                    if (response.ok) {
                        const data = await response.json();
                        this.content = { ...this.content, ...data };
                    }
                } catch (error) {
                    console.error('Error loading content:', error);
                }
            }
        }).mount('#app');
    </script>
</body>
</html>